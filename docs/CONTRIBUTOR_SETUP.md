# Contributor Setup Guide

This guide helps new contributors set up their development environment for the ado-mcp project.

## Quick Start

### 1. Clone and Setup
```bash
git clone <repository-url>
cd ado-mcp
task install
```

### 2. Configure Azure DevOps Credentials
```bash
# Create .env file with your credentials
task setup-env

# Edit .env and update with your actual values
cp .env.example .env
# Edit .env file:
# - Replace 'your_personal_access_token_here' with your actual Azure DevOps PAT
# - Update ADO_ORGANIZATION_URL with your organization URL
```

### 3. Create Azure DevOps Personal Access Token

1. Go to https://dev.azure.com/[YourOrganization]/_usersSettings/tokens
2. Click "New Token"
3. Set the following permissions:
   - **Project and team**: read, write, & manage
   - **Build**: read & execute
   - **Code**: read (for repository access)
   - **Work items**: read & write
4. Copy the token and paste it into your `.env` file

### 4. Provision Test Environment
```bash
# This creates the ado-mcp2 project and all test pipelines automatically
task ado-up
```

### 5. Run Tests
```bash
# Run all tests
task test

# Run tests sequentially (for debugging)
task test-sequential

# Run a specific test
task test-single TEST_NAME=tests/pipelines/test_get_pipeline.py::test_get_pipeline_structure
```

### 6. Clean Up (Optional)
```bash
# Destroy the test environment when done
task ado-down
```

## Environment Variables

The project uses these environment variables:

### Required for Tests
- `AZURE_DEVOPS_EXT_PAT` - Your Azure DevOps Personal Access Token
- `ADO_ORGANIZATION_URL` - Your Azure DevOps organization URL

### Required for Terraform
- `AZDO_PERSONAL_ACCESS_TOKEN` - Same as AZURE_DEVOPS_EXT_PAT (different name for Terraform provider)
- `AZDO_ORG_SERVICE_URL` - Same as ADO_ORGANIZATION_URL (different name for Terraform provider)

### Optional
- `GITHUB_TOKEN` - For testing GitHub-integrated pipelines

## Project Architecture

### Dynamic Configuration System
The project uses a dynamic configuration system that eliminates hardcoded values:

- **`src/test_config.py`** - Dynamic configuration loader
- **`tests/terraform_config.json`** - Generated by Terraform with real resource IDs
- **Name-based lookups** - Tests use pipeline names, not hardcoded IDs

### Terraform Infrastructure
- **`terraform/`** - Infrastructure as Code for test environment
- **Modular design** - Separate modules for projects, pipelines, permissions
- **Automatic pipeline creation** - Creates all 7 test pipelines with real YAML files

### Key Commands
- `task ado-up` - Provision Azure DevOps test environment
- `task ado-down` - Destroy test environment
- `task test` - Run full test suite
- `task auth-test` - Test your Azure DevOps authentication

## Troubleshooting

### Authentication Issues
```bash
# Test your Azure DevOps connection
task auth-test

# Check your .env file
cat .env
```

### Terraform Issues
```bash
# Check Terraform state
cd terraform && terraform show

# Reinitialize Terraform
cd terraform && terraform init
```

### Test Failures
```bash
# Run tests sequentially for better error messages
task test-sequential

# Test dynamic configuration loading
uv run python -c "from src.test_config import validate_test_environment; print(validate_test_environment())"
```

## Contributing

1. Make sure all tests pass: `task test`
2. Format code: `task format`
3. Type check: `task typecheck`
4. Clean up test environment when done: `task ado-down`

For more detailed documentation, see the individual files in the `docs/` directory.